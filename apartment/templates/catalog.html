{% load static %}
{% load custom_filters %}

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Каталог | GOSTI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Aboreto&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Aboreto&display=swap" rel="stylesheet">
    <link href="{% static 'css/main.css' %}" rel="stylesheet">
    <script src="{% static 'js/main.js' %}" defer></script>
</head>
<body>

    <!-- Шапка -->
    <header class="bg-white py-2 px-5 d-flex justify-content-between align-items-center">
        <div class="container d-flex justify-content-between align-items-center">
        <div class="text-center" style="font-size: 36px !important; font-family: 'Aboreto', cursive;"><a href="/">GOSTI<p style="font-size: 12px; vertical-align: bottom;">VLADIVOSTOK</p></a></div>
        <nav>
            <a href="#" class="text-dark text-decoration-none mx-3">О нас</a>
            <a href="{% url 'catalog' %}" class="text-dark text-decoration-none mx-3 active-nav">Квартиры</a>
            <a href="#reviews" class="text-dark text-decoration-none mx-3">Отзывы</a>
            <a href="#questions" class="text-dark text-decoration-none mx-3">Вопросы</a>
            <a href="#" class="text-dark text-decoration-none mx-3">Контакты</a>
        </nav>
        <div class="text-end">
    <div class="d-flex align-items-center justify-content-end">
        <a href="#" class="me-2 text-primary fs-5">
            <img src="{% static 'img/telegram.png' %}" alt="telegram" class="img-fluid">
        </a>
        <a href="#" class="me-2 text-success fs-5">
            <img src="{% static 'img/whatsapp.png' %}" alt="whatsapp" class="img-fluid">
        </a>
        <p class="mb-0 text-dark ms-2">+7 (900) 123-45-67</p>
    </div>
    {% if user.is_authenticated %}
    <div class="text-end d-flex align-items-center justify-content-end mt-3">
        <a href="#" class="text-dark text-decoration-none me-2" id="profileLink">Личный кабинет</a>
        <i class="bi bi-person fs-5 text-dark"></i>
    </div>
            {% else %}
    <div class="text-end d-flex align-items-center justify-content-end mt-3">
        <a href="{% url 'login' %}" class="text-dark text-decoration-none me-2">Личный кабинет</a>
        <i class="bi bi-person fs-5 text-dark"></i>
    </div>
            {% endif %}

    <!-- Шторка -->
    <div id="sidebar" class="sidebar">
        <div class="sidebar-content mt-5 text-center">
            <span class=" fs-5 text-center">Рады видеть вас вновь</span>
            {% if user.is_authenticated %}
            <p>{{ user.username }}</p>
            {% endif %}
        </div>
        <div class="sidebar-content mt-5" style="text-align: left;">
            <span class=" fs-6">Бронирования</span>
            <hr>
            {% if active_bookings %}
            {% for booking in active_bookings %}
            <div class="active-booking">
                <div class="row mb-3">
                <div class="col-12">
                    <a href="{% url 'card' booking.apartment.id %}">
                        <img src="{% static 'img/Frame 610.png' %}" alt="Фото квартиры" class="img-fluid">
                    </a>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-12">
                        <div class="d-flex justify-content-between">
                            <a href="{% url 'card' booking.apartment.id %}" class="fs-6">{{ booking.apartment.name }}</a>
                            <span class="text-muted"><i class="bi bi-people fs-6"></i> до {{ booking.apartment.quantity_people }} мест</span>
                            <span class="text-muted"><i class="bi bi-arrows-angle-contract"></i> {{ booking.apartment.square }} м²</span>
                        </div>
                        <div class="d-flex justify-content-between mt-4">
                            <span><strong>Заезд:</strong> {{ booking.start_date|date:"d-m-Y" }}</span>
                        </div>
                        <div class="d-flex justify-content-between mt-2">
                            <span><strong>Выезд:</strong> {{ booking.end_date|date:"d-m-Y" }}</span>
                        </div>
                        <div class="d-flex justify-content-between mt-5">
                            <span>Стоимость</span>
                            <span>{{ booking.total_price|round_price }} ₽ <span class="card-text text-muted fs-6">/ {{ booking.get_total_days }} суток</span></span>
                        </div>
                    </div>
                </div>
                <hr>
            </div>
            {% endfor %}
        {% else %}
            <p>Нет активных бронирований</p>
        {% endif %}
        </div>
        <div class="sidebar-content text-center">
            <a href="{% url 'logout' %}" id="logoutLink" class="text-dark">
                <i class="bi bi-box-arrow-right fs-4 me-1"></i> Выйти
            </a>
        </div>
        <button id="closeSidebar" class="btn-close"></button>
    </div>

    <div id="overlay" class="overlay"></div>
</div>
        </div>
    </header>




    <!-- Рекомендованные предложения -->
<section class="container mt-3 catalog">
    <div class="border p-4 mb-5" style="border-radius: 10px !important;">
        <form class="row g-3" method="get">
            <div class="col-md-4 form-floating">
                {% if date_start %}
                <input type="date" class="form-control" id="check-in-date" name="check-in-date" required placeholder=" " value="{{ date_start }}" min="{{ date_now }}" onchange="updateMinCheckoutDate()">
                {% else %}
                <input type="date" class="form-control" id="check-in-date" name="check-in-date" required placeholder=" " min="{{ date_now }}" onchange="updateMinCheckoutDate()">
                {% endif %}
                <label for="check-in-date" class="form-label">Дата въезда</label>
            </div>
            <div class="col-md-4 form-floating">
                {% if date_end %}
                <input type="date" class="form-control" id="check-out-date" name="check-out-date" required placeholder=" " value="{{ date_end }}" min="{{ date_tomorrow }}">
                {% else %}
                <input type="date" class="form-control" id="check-out-date" name="check-out-date" required placeholder=" " min="{{ date_tomorrow }}">
                {% endif %}
                <label for="check-out-date" class="form-label">Дата выезда</label>
            </div>
            <div class="col-md-4 form-floating">
                <select class="form-select" id="people-count" name="people-count" required>
                    <option value="" {% if not people_count %}selected{% endif %}>Выберите количество</option>
                    {% for num in people_options %}
                        <option value="{{ num }}" {% if people_count == num %}selected{% endif %}>
                            {{ num }} человек
                        </option>
                    {% endfor %}
                </select>
                <label for="people-count" class="form-label">Количество людей</label>
            </div>
            <div class="col-2">
                <button type="submit" class="btn btn-primary w-100 catalog-search">Найти</button>
            </div>
        </form>
    </div>

    <div class="d-flex justify-content-between align-items-center mb-4">
        <span class="fs-2" style="font-size: 48px !important; font-weight: 500; line-height: 48px;">Подборка квартир</span>

    </div>

    <div class="row g-4 mt-4">
        {% for apart in aparts %}
        <div class="col-md-4">
            <div class="card shadow-sm card-apart-catalog">
                <img src="{% static 'img/Photo_1.png' %}" class="card-img-top" alt="Квартира">
                <div class="card-body">
                    <h5 class="card-title">{{ apart.name }}</h5>
                    <p class="card-text text-muted card-desc-apart"><i class="bi bi-people fs-6"></i> до {{ apart.quantity_people }} мест • {{ apart.square }} м²</p>
                    <div class="d-flex justify-content-between align-items-center card-apart-block-price">
                        <span class="fs-5">от {{ apart.price|round_price }} ₽ <span class="card-text text-muted fs-6">/ сутки</span></span>
                        <a href="{% url 'card' apart.id %}{% if request.GET.urlencode %}?{{ request.GET.urlencode }}{% endif %}" class="btn btn-outline-primary" style="padding: 10px 20px;">Выбрать</a>
                    </div>
                </div>
            </div>

        </div>
        {% endfor %}






    </div>
</section>



    <section class="container my-5 position-relative mt-5 reviews-container" id="reviews">
    <span class="fs-2 text-left mb-4" style="font-size: 48px !important; font-weight: 500; line-height: 48px;">Отзывы наших гостей</span>

    <div class="text-left mb-4" style="margin-top: 20px;">
        <span class="fw-bold" style="font-size: 24px; color: #273B7D;">Booking</span>
        <span class="fw-bold" style="color: #499FDD; font-size: 24px;">.com</span>
    </div>

    <div class="position-relative">
        <div class="position-absolute top-0 end-0 d-flex gap-2 review-controls">
            <button class="arrow" id="prevReview">
                <img src="{% static 'img/Arrow 2.png' %}" alt="arrow">
            </button>
            <button class="arrow" id="nextReview">
                <img src="{% static 'img/Arrow 1.png' %}" alt="arrow">
            </button>
        </div>
    </div>

    <div class="overflow-hidden w-100 mt-5 position-relative" style="margin-top: 60px !important;">
        <div class="d-flex gap-3 flex-nowrap w-100" id="reviewsContainer">
            <div class="card p-3 shadow-sm flex-grow-1 review-card">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-1" style="font-weight: 600;">Отличное место!</h5>
                    <div class="d-flex">
                        <i class="bi bi-star-fill text-warning fs-5"></i>
                        <i class="bi bi-star-fill text-warning fs-5"></i>
                        <i class="bi bi-star-fill text-warning fs-5"></i>
                        <i class="bi bi-star-fill text-warning fs-5"></i>
                        <i class="bi bi-star-fill text-warning fs-5"></i>
                    </div>
                </div>
                <p class="small" style="font-weight: 500;">Квартира просто замечательная! Чистая, светлая и очень уютная. В ней есть все необходимое для комфортного проживания. Особенно понравилась кухня — мы готовили ужины и наслаждались семейными вечерами. Рекомендуем всем!</p>
                <div class="d-flex align-items-center mt-auto">
                    <img src="{% static 'img/Yana_Photo.png' %}" class="rounded-circle me-2" alt="User">
                    <div>
                        <strong>Анна.С</strong>
                        <p class="text-muted small mb-0">22.02.2025</p>
                    </div>
                </div>
            </div>

            <div class="card p-3 shadow-sm flex-grow-1 review-card">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-1" style="font-weight: 600;">Отличное место!</h5>
                    <div class="d-flex">
                        <i class="bi bi-star-fill text-warning fs-5"></i>
                        <i class="bi bi-star-fill text-warning fs-5"></i>
                        <i class="bi bi-star-fill text-warning fs-5"></i>
                        <i class="bi bi-star-fill text-warning fs-5"></i>
                        <i class="bi bi-star-fill text-warning fs-5"></i>
                    </div>
                </div>
                <p class="small" style="font-weight: 500;">Квартира просто замечательная! Чистая, светлая и очень уютная. В ней есть все необходимое для комфортного проживания. Особенно понравилась кухня — мы готовили ужины и наслаждались семейными вечерами. Рекомендуем всем!</p>
                <div class="d-flex align-items-center mt-auto">
                    <img src="{% static 'img/Yana_Photo.png' %}" class="rounded-circle me-2" alt="User">
                    <div>
                        <strong>Анна.С</strong>
                        <p class="text-muted small mb-0">22.02.2025</p>
                    </div>
                </div>
            </div>

            <div class="card p-3 shadow-sm flex-grow-1 review-card">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-1" style="font-weight: 600;">Отличное место!</h5>
                    <div class="d-flex">
                        <i class="bi bi-star-fill text-warning fs-5"></i>
                        <i class="bi bi-star-fill text-warning fs-5"></i>
                        <i class="bi bi-star-fill text-warning fs-5"></i>
                        <i class="bi bi-star-fill text-warning fs-5"></i>
                        <i class="bi bi-star-fill text-warning fs-5"></i>
                    </div>
                </div>
                <p class="small" style="font-weight: 500;">Квартира просто замечательная! Чистая, светлая и очень уютная. В ней есть все необходимое для комфортного проживания. Особенно понравилась кухня — мы готовили ужины и наслаждались семейными вечерами. Рекомендуем всем!</p>
                <div class="d-flex align-items-center mt-auto">
                    <img src="{% static 'img/Yana_Photo.png' %}" class="rounded-circle me-2" alt="User">
                    <div>
                        <strong>Анна.С</strong>
                        <p class="text-muted small mb-0">22.02.2025</p>
                    </div>
                </div>
            </div>

            <div class="card p-3 shadow-sm flex-grow-1 review-card">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-1" style="font-weight: 600;">Отличное место!</h5>
                    <div class="d-flex">
                        <i class="bi bi-star-fill text-warning fs-5"></i>
                        <i class="bi bi-star-fill text-warning fs-5"></i>
                        <i class="bi bi-star-fill text-warning fs-5"></i>
                        <i class="bi bi-star-fill text-warning fs-5"></i>
                        <i class="bi bi-star-fill text-warning fs-5"></i>
                    </div>
                </div>
                <p class="small" style="font-weight: 500;">Квартира просто замечательная! Чистая, светлая и очень уютная. В ней есть все необходимое для комфортного проживания. Особенно понравилась кухня — мы готовили ужины и наслаждались семейными вечерами. Рекомендуем всем!</p>
                <div class="d-flex align-items-center mt-auto">
                    <img src="{% static 'img/Yana_Photo.png' %}" class="rounded-circle me-2" alt="User">
                    <div>
                        <strong>Анна.С</strong>
                        <p class="text-muted small mb-0">22.02.2025</p>
                    </div>
                </div>
            </div>

            <div class="card p-3 shadow-sm flex-grow-1 review-card">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-1" style="font-weight: 600;">Отличное место!</h5>
                    <div class="d-flex">
                        <i class="bi bi-star-fill text-warning fs-5"></i>
                        <i class="bi bi-star-fill text-warning fs-5"></i>
                        <i class="bi bi-star-fill text-warning fs-5"></i>
                        <i class="bi bi-star-fill text-warning fs-5"></i>
                        <i class="bi bi-star-fill text-warning fs-5"></i>
                    </div>
                </div>
                <p class="small" style="font-weight: 500;">Квартира просто замечательная! Чистая, светлая и очень уютная. В ней есть все необходимое для комфортного проживания. Особенно понравилась кухня — мы готовили ужины и наслаждались семейными вечерами. Рекомендуем всем!</p>
                <div class="d-flex align-items-center mt-auto">
                    <img src="{% static 'img/Yana_Photo.png' %}" class="rounded-circle me-2" alt="User">
                    <div>
                        <strong>Анна.С</strong>
                        <p class="text-muted small mb-0">22.02.2025</p>
                    </div>
                </div>
            </div>


        </div>
    </div>
</section>



    <section class="container my-5 end-container" id="questions">
        <span class="fs-2 text-left mb-4" style="font-size: 48px !important; font-weight: 500; line-height: 48px;">Остались вопросы?</span>

    <p class="text-left mb-4 mt-4" style="margin-bottom: 80px !important; font-weight: 500; font-size: 20px;">Мы понимаем, что аренда квартиры — это важное решение, и у вас <br>могут возникнуть дополнительные вопросы. Наша команда всегда <br>готова помочь вам!</p>

    <div class="d-flex justify-content-between align-items-center position-relative">
        <div>
            <img src="{% static 'img/image 332.png' %}" alt="Question Image" class="w-100">
        </div>

        <!-- Форма -->
        <div class="position-absolute end-0 translate-middle-y w-25 p-3 me-5 bg-white border rounded shadow-sm form-end">
            <form action="#" method="POST">
                <div class="mb-3">
                    <label for="name" class="form-label" style="font-size: 20px; font-weight: 500;">Имя</label>
                    <input type="text" class="form-control" id="name" required placeholder="Введите имя" style="padding: 10px 20px;">
                </div>
                <div class="mb-3">
                    <label for="email" class="form-label" style="font-size: 20px; font-weight: 500;">Номер телефона</label>
                    <input type="email" class="form-control" id="email" required placeholder="+7" style="padding: 10px 20px;">
                </div>
                <div class="mb-3">
                    <label for="question" class="form-label" style="font-size: 20px; font-weight: 500;">Сообщение</label>
                    <textarea class="form-control" id="question" rows="4" required placeholder="Введите текст сообщения" style="padding: 10px 20px;"></textarea>
                </div>
                <button type="submit" class="btn btn-primary w-100 form-end-button">Оставить заявку</button>
            </form>
        </div>
    </div>
</section>
    <section class="container my-5">
    <footer class="bg-white py-3 px-5 d-flex justify-content-between align-items-center footer">
    <div class="nav-container d-flex justify-content-center w-75">
        <nav>
            <a href="#" class="text-dark text-decoration-none mx-3">О нас</a>
            <a href="{% url 'catalog' %}" class="text-dark text-decoration-none mx-3">Квартиры</a>
            <a href="#reviews" class="text-dark text-decoration-none mx-3">Отзывы</a>
            <a href="#questions" class="text-dark text-decoration-none mx-3">Вопросы</a>
            <a href="#" class="text-dark text-decoration-none mx-3">Контакты</a>
        </nav>
    </div>
    <div class="text-end">
        <div class="d-flex align-items-center justify-content-end">
            <a href="#" class="me-2 text-primary fs-5">
                <img src="{% static 'img/telegram.png' %}" alt="telegram" class="img-fluid">
            </a>
            <a href="#" class="me-2 text-success fs-5">
                <img src="{% static 'img/whatsapp.png' %}" alt="whatsapp" class="img-fluid">
            </a>
            <p class="mb-0 text-dark ms-2">+7 (900) 123-45-67</p>
        </div>
        <div class="text-end d-flex align-items-center justify-content-end mt-3">
            <span>г. Владивосток</span>
        </div>
    </div>
</footer>
    </section>








    <!-- Подключение Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('check-in-date').setAttribute('min', today);

    function updateMinCheckoutDate() {
        const checkInDate = document.getElementById('check-in-date').value;
        if (checkInDate) {
            const checkIn = new Date(checkInDate);
            checkIn.setDate(checkIn.getDate() + 1);

            const checkOutMinDate = checkIn.toISOString().split('T')[0];
            document.getElementById('check-out-date').setAttribute('min', checkOutMinDate);
        }
    }

    window.onload = updateMinCheckoutDate;
</script>
</body>
</html>
